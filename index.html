<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="description" content="A fun bubble popping game for mobile and PWA">
  <title>Toddler Pop Game</title>
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.json">
  <style>
    html, body {
      overscroll-behavior-x: none; /* disable horizontal nav */
      height: 100%; margin: 0; padding: 0;
      background: #000; color: #fff;
      font-family: system-ui, sans-serif;
      -webkit-user-select: none; user-select: none;
      overscroll-behavior: none; touch-action: none;
      display: flex; flex-direction: column;
    }
    #game {
      flex: 1; position: relative; overflow: hidden;
    }
    .bubble {
      position: absolute; border-radius: 50%; border: none;
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; color: white;
      text-align: center;
      box-shadow: 0 6px 16px rgba(0,0,0,.3);
      transition: transform .1s ease;
      width: 110px; height: 110px;
    }
    .bubble:active { transform: scale(0.9); }
    .pop { animation: pop .2s ease-out forwards; }
    @keyframes pop {
      to { transform: scale(1.3); opacity: 0; }
    }
    .menu-btn {
      padding: 14px 20px; border: none; border-radius: 12px;
      font-weight: bold; font-size: 16px; cursor: pointer;
      background: #2563eb; color: #fff;
      margin: 8px;
    }
    #menu { text-align: center; padding: 15px; }
    #pwa-install {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #4caf50;
      color: #fff;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 1em;
      display: none;
      z-index: 3;
    }
    .message {
      font-size: 50px;
      color: #222;
      text-align: center;
      font-weight: bold;
      margin-top: 100px;
    }
  </style>
</head>
<body>
  <div id="menu">
    <button class="menu-btn" data-mode="numbers">ðŸ”¢ Numbers</button>
    <button class="menu-btn" data-mode="letters">ðŸ”¤ Alphabets</button>
    <button class="menu-btn" data-mode="colors">ðŸŽ¨ Colors</button>
    <button class="menu-btn" data-mode="random">ðŸŽ² Random</button>
  </div>
  <main id="game">
    <div class="message">Stops after 50 pops<br/><br/>(ðŸ”Š)</div>
  </main>
  <button id="pwa-install">Install App</button>
  <script>
    const game = document.getElementById('game');
    const menu = document.getElementById('menu');

    let score = 0;
    let bubbles = [];
    let currentMode = "";

    const COLORS = ["red","orange","yellow","green","blue","purple","pink"];
    const COLOR_CODES = {
      red: "#ef4444",
      orange: "#f97316",
      yellow: "#eab308",
      green: "#22c55e",
      blue: "#3b82f6",
      purple: "#8b5cf6",
      pink: "#ec4899"
    };

    function speak(text) {
      if ('speechSynthesis' in window) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.pitch = 1; utter.rate = 0.9;
        window.speechSynthesis.speak(utter);
      }
    }

    function getModeForRound() {
      if (currentMode !== "random") return currentMode;
      const modes = ["numbers","letters","colors"];
      return modes[Math.floor(Math.random() * modes.length)];
    }

    function spawnBubbles() {
      game.innerHTML = '';
      bubbles = [];

      const roundMode = getModeForRound();
      const num = Math.floor(Math.random()*5) + 1; // 1â€“5 bubbles
      let labels = [];

      if (roundMode === "numbers") {
        labels = Array.from({length: num}, (_, i) => (i+1).toString());
      } else if (roundMode === "letters") {
        labels = Array.from({length: num}, (_, i) => String.fromCharCode(65+i));
      } else if (roundMode === "colors") {
        labels = COLORS.slice(0, num);
      }

      const size = 110;
      const gap = 20;

      if (roundMode === "colors") {
        // Place randomly
        const { width, height } = game.getBoundingClientRect();
        labels.forEach(label => {
          const b = document.createElement('button');
          b.className = 'bubble';
          b.style.fontSize = "14px"; // smaller font for color names
          b.style.background = COLOR_CODES[label];
          b.textContent = label;
          b.style.left = Math.random() * (width - size - 20) + "px";
          b.style.top  = Math.random() * (height - size - 20) + "px";
          b.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            popBubble(b,label);
          });
          game.appendChild(b);
          bubbles.push({el:b,label});
        });
      } else {
        // Grid placement for numbers/letters
        const cols = Math.min(num, 3);
        const startX = (game.clientWidth - (cols * size + (cols-1)*gap)) / 2;
        const startY = (game.clientHeight - (Math.ceil(num/cols) * size + (Math.ceil(num/cols)-1)*gap)) / 2;

        labels.forEach((label, i) => {
          const row = Math.floor(i / cols);
          const col = i % cols;
          const b = document.createElement('button');
          b.className = 'bubble';
          b.style.fontSize = "55px"; // large font for toddlers
          b.style.left = (startX + col*(size+gap)) + 'px';
          b.style.top  = (startY + row*(size+gap)) + 'px';
          b.style.background = COLOR_CODES[COLORS[(Math.random()*COLORS.length)|0]];
          b.textContent = label;
          b.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            popBubble(b,label);
          });
          game.appendChild(b);
          bubbles.push({el:b,label});
        });
      }
    }

    function popBubble(b,label) {
      reqFullScrn();
      const bubbleObj = bubbles.find(x => x.el === b);
      if (!bubbleObj) return;

      b.classList.add('pop');
      setTimeout(() => b.remove(), 200);
      score++;
      speak(label);
      bubbles = bubbles.filter(x => x.el !== b);
      if (bubbles.length === 0) {
        if (score >= 50) {
          const message = "Great job baby!";
          speak(message);
          game.innerHTML = `<div class="message">${message}</div>`;
        } else{
          setTimeout(spawnBubbles, 1000);
        }
      }
    }

    function reqFullScrn() {
      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen().catch(()=>{});
      }
    }

    // Menu button click
    document.querySelectorAll('.menu-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        reqFullScrn();
        currentMode = btn.dataset.mode;
        menu.style.display = "none"; // hide menu after selection
        spawnBubbles();
      });
    });

    history.pushState(null, null, location.href);
      window.onpopstate = function () {
      history.go(1); // lock in place
    };
  </script>
  <script src="pwa.js"></script>
</body>
</html>
